<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Máquina de Noticias - Chat de Investigación</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="css/custom.css">
</head>
<body>
    <nav class="p-4">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-lg">Máquina de Noticias</h1>
            <ul class="flex space-x-6">
                <li><a href="index.html">Inicio</a></li>
                <li><a href="dashboard.html">Dashboard</a></li>
                <li><a href="chat.html" class="font-medium">Chat de Investigación</a></li>
                <li><a href="developer.html">Panel Desarrollador</a></li>
                <li><a href="ingesta.html">Ingesta de Documentos</a></li>
            </ul>
        </div>
    </nav>

    <div class="container mx-auto px-4 py-6">
        <div class="max-w-3xl mx-auto">
            <!-- Área de Chat -->
            <div class="bg-white border border-gray-200 rounded min-h-[400px] flex flex-col">
                <!-- Mensajes -->
                <div class="flex-grow overflow-y-auto p-4 space-y-4" id="chat-messages">
                    <!-- Mensaje inicial del hecho noticioso -->
                    <div class="bg-gray-50 rounded p-4">
                        <p id="hecho-inicial" class="text-sm">
                            <!-- Contenido del hecho se cargará dinámicamente -->
                        </p>
                    </div>
                </div>
                
                <!-- Input del Chat -->
                <div class="border-t p-4">
                    <div class="relative">
                        <textarea
                            id="message-input"
                            class="w-full border border-gray-300 rounded p-2 resize-none h-16 text-sm"
                            placeholder="Escriba su consulta..."
                        ></textarea>
                        <button
                            id="send-message"
                            class="absolute right-2 bottom-2 primary"
                        >
                            Enviar
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="bg-gray-800 text-white p-4 mt-8">
        <div class="container mx-auto text-center">
            <p>Máquina de Noticias - Simulación Visual para Presentación</p>
        </div>
    </footer>

    <script src="js/mockData.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const hechoId = parseInt(urlParams.get('hecho'));
            
            if (hechoId) {
                const hecho = mockData.hechos.find(h => h.id === hechoId);
                if (hecho) {
                    // Mostrar explicación inicial del hecho
                    const hechoInicial = document.getElementById('hecho-inicial');
                    hechoInicial.textContent = generateExplicacion(hecho);
                }
            }
            
            // Configurar chat
            const messageInput = document.getElementById('message-input');
            const sendButton = document.getElementById('send-message');
            const chatMessages = document.getElementById('chat-messages');
            
            sendButton.addEventListener('click', sendMessage);
            messageInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
            
            function sendMessage() {
                const message = messageInput.value.trim();
                if (!message) return;
                
                // Añadir mensaje del usuario
                const userMessageDiv = document.createElement('div');
                userMessageDiv.className = 'text-right';
                userMessageDiv.innerHTML = `
                    <div class="inline-block bg-blue-50 text-blue-800 rounded p-3 max-w-[80%] text-sm">
                        ${message}
                    </div>
                `;
                chatMessages.appendChild(userMessageDiv);
                
                messageInput.value = '';
                chatMessages.scrollTop = chatMessages.scrollHeight;
                
                // Simular respuesta
                setTimeout(() => {
                    const botMessageDiv = document.createElement('div');
                    botMessageDiv.className = 'text-left';
                    botMessageDiv.innerHTML = `
                        <div class="inline-block bg-gray-50 text-gray-800 rounded p-3 max-w-[80%] text-sm">
                            Esta es una simulación. En la implementación real, aquí aparecería una respuesta contextual basada en la consulta "${message}".
                        </div>
                    `;
                    chatMessages.appendChild(botMessageDiv);
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                }, 1000);
            }
        });
        
        function generateExplicacion(hecho) {
            // Generar una explicación de ~200 palabras basada en el hecho
            const entidadesTexto = hecho.entidades_mencionadas?.join(', ') || '';
            return `
Este hecho noticioso se refiere a ${hecho.contenido}

Ocurrido el ${new Date(hecho.fecha_ocurrencia.inicio).toLocaleDateString('es-ES', { 
    day: 'numeric', 
    month: 'long', 
    year: 'numeric' 
})}, este evento tiene una importancia de ${hecho.importancia} en una escala del 1 al 10 y ha sido clasificado como ${hecho.tipo_hecho}.

${hecho.entidades_mencionadas ? `Las principales entidades mencionadas incluyen: ${entidadesTexto}.` : ''}

Este hecho forma parte del hilo narrativo "${hecho.hilo_vinculado?.titulo}", el cual agrupa eventos relacionados que permiten entender el contexto más amplio de esta situación.

Ha sido reportado por múltiples medios de comunicación, demostrando su relevancia en el panorama actual de noticias.

¿Qué aspecto específico de este hecho te gustaría explorar más a fondo?
            `.trim();
        }
    </script>
</body>
</html>
